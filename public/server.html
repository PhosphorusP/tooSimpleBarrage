<html>
	<head>
		<script src="../source/socket.io.slim.js"></script>
    	<script>
        	var socket = io.connect('/');
        	var styleBackup = '';
        	function init() {
        		if(styleBackup.length == 0) styleBackup = document.getElementById('preCSS').innerHTML;
        		else document.getElementById('preCSS').innerHTML = styleBackup;
        		document.getElementById('preCSS').innerHTML = document.getElementById('preCSS').innerHTML.replace(/cwidth/g,document.getElementById("container").offsetWidth);
        	}
        	function pushBarrage(str) {
        		var bstr = '<div class="message" style="animation: message 15s linear;top:' + (Math.random() * (window.innerHeight - 64) * 1) + 'px;animation-delay: ' + (Math.random() * 3 + 0) + 's;">' + str + '</div>';
    			var barrage = new DOMParser().parseFromString(bstr,'text/html').querySelector('div');
    			barrage.addEventListener('animationend', function() {
    				//this.parentNode.removeChild(this);
    			});
    			document.getElementById('container').appendChild(barrage);
        	}
			socket.on('connect', function () {
    			console.log('%cConnected to the server successfully.','color: #080');
    			socket.on('barrage', function(data) {
    				pushBarrage(data.message);
				});
    		});
    </script>
    <style id="preCSS">
        #container {
        	position: fixed;
        	left: 0;
        	top: 0;
        	width: 100%;
        	height: 100%;
        	overflow: hidden;
        }
        @keyframes message {
        	0% {
        		opacity: 1;
        		transform: translateX(cwidthpx);
        	}
        	100% {
        		opacity: 1;
        		transform: translateX(-cwidthpx);
        	}
        }
    	.message {
    		position: absolute;
    		width: 100%;
    		left: 0;
    		top: 0;
    		font-weight: bold;
    		font-family: sans-serif;
    		color: #FFF;
    		font-size: 36px;
    		text-shadow: 0 0 32px #000;
    		opacity: 0;
    		white-space: nowrap;
    	}
    </style>
	</head>
	<body>
		<div id="container"></div>
		<script>
			init();
			for(i=1;i<=8;i++) pushBarrage('tooSimpleBarrage已启动。')
		</script>
	</body>
</html>